<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="fdde477c-81f0-4fd0-a7f9-4aa8fb53d377" activeEnvironment="Default" name="CA_World_2017-OTK-4.1" resourceRoot="" soapui-version="5.3.0" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:description>This project executes a complete OpenID Connect flow. Update these 'Custom Properties': host_iss, resource_owner, resource_owner_password</con:description><con:settings/><con:testSuite id="9adaf79a-8305-464e-8d78-5a527f340b03" name="WhatsNew"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="f7d798f0-19b8-469a-aac0-952f53c69557" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="OpenID-Config-Registration" searchProperties="true"><con:settings/><con:testStep type="httprequest" name="GetConfiguration" id="34f3a985-0c85-4519-a79b-0f2882738c3f"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="a3b23d0d-1d5a-4945-a1d0-ddc278cd9540" name="GetConfiguration" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:description>Get the OpenID server configuration</con:description><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#host_iss}${#Project#path_configuration}</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:config></con:testStep><con:testStep type="transfer" name="ConfigDetails" id="edb48cb6-22fc-44a6-b839-6e67953174d1"><con:description>Extract a few details such as the path to '/register'</con:description><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Path_Register</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>GetConfiguration</con:sourceStep><con:sourcePath>registration_endpoint</con:sourcePath><con:targetType>Endpoint</con:targetType><con:targetStep>DynamicClientRegistration</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Path_Token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>GetConfiguration</con:sourceStep><con:sourcePath>token_endpoint</con:sourcePath><con:targetType>path_token</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Path_Authorize</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>GetConfiguration</con:sourceStep><con:sourcePath>authorization_endpoint</con:sourcePath><con:targetType>path_authorize</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Path_Userinfo</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>GetConfiguration</con:sourceStep><con:sourcePath>userinfo_endpoint</con:sourcePath><con:targetType>path_userinfo</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Path_JWKS</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>GetConfiguration</con:sourceStep><con:sourcePath>jwks_uri</con:sourcePath><con:targetType>path_jwks</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="groovy" name="GenerateOrg" id="5cf520c9-60e8-4c98-87d2-ea262568ee28"><con:description>This is used as 'fake' organization name to combine it with the client_name. This way, for the demo, we can register the 'same' client multiple times</con:description><con:settings/><con:config><script>def fakeOrg = new Date().format("HHmmss")</script></con:config></con:testStep><con:testStep type="transfer" name="TransferFakeOrg" id="1f9c8623-ab99-4ec1-8d4f-1c3bcc4720a9"><con:description>Extract the fakeOrg value into the property 'fakeOrg'</con:description><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>fakeOrg</con:name><con:sourceType>result</con:sourceType><con:sourceStep>GenerateOrg</con:sourceStep><con:targetType>fakeOrg</con:targetType><con:targetStep>fakeOrg</con:targetStep><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="properties" name="fakeOrg" id="64fa6721-437d-45c0-bad7-ac1f0da23b65"><con:description>Property holding the value of 'fakeOrg'</con:description><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>fakeOrg</con:name><con:value>133021</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="httprequest" name="DynamicClientRegistration" id="9000ffcc-6577-4529-ab3f-1609f1fed92e"><con:settings/><con:config method="POST" xsi:type="con:HttpRequest" id="6bceded6-80a6-42ec-af39-b0a8a7db1e58" name="DynamicClientRegistration" postQueryString="false" mediaType="application/json" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:description>Register a new client. If this fail the client has been registered beforehand with the same details</con:description><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://your-gateway:8443/openid/connect/register</con:endpoint><con:request>{
	"application_type": "${#Project#application_type}",
	"redirect_uris": ["${#Project#redirect_uri}"],
	"client_name": "${#Project#client_name}-${#fakeOrg}",
	"subject_type": "pairwise",
	"token_endpoint_auth_method": "client_secret_basic",
	"contacts": ["${#Project#contact_alias}","${#Project#contact_email}"]
}</con:request><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:config></con:testStep><con:testStep type="transfer" name="RegistrationDetails" id="47141701-b6a0-48ce-a441-0befdfa1a395"><con:description>Extract details such as the access_token and registration_client_uri</con:description><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>client_id</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>DynamicClientRegistration</con:sourceStep><con:sourcePath>client_id</con:sourcePath><con:targetType>client_id</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>client_secret</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>DynamicClientRegistration</con:sourceStep><con:sourcePath>client_secret</con:sourcePath><con:targetType>client_secret</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>scope</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>DynamicClientRegistration</con:sourceStep><con:sourcePath>scope</con:sourcePath><con:targetType>scope</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="groovy" name="GenerateState" id="70ee75cd-eb7b-421a-965c-b7c7793cc823"><con:description>Using the time as 'state'. This would usually be something like a client sessionID</con:description><con:settings/><con:config><script>new Date().format("HHmmss")</script></con:config></con:testStep><con:testStep type="transfer" name="TransferState" id="6b0cb866-a65d-4c5f-a22c-ec6d842f72e5"><con:description>Move the generate 'state' into our authorization request</con:description><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>state</con:name><con:sourceType>result</con:sourceType><con:sourceStep>GenerateState</con:sourceStep><con:targetType>state</con:targetType><con:targetStep>AuthorizationRequest - code</con:targetStep><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="httprequest" name="AuthorizationRequest - code" id="990996d9-b097-4d0d-864b-fe79eba4c731"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="4fe1991a-a88f-418a-b529-5ad6c3be6ba8" name="AuthorizationRequest - code" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:description>Initiating the authorization code flow. The response is a redirect, 302, which we simply follow</con:description><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting></con:settings><con:endpoint>${#TestSuite#path_authorize}</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>client_id</con:name><con:value>${#TestSuite#client_id}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>response_type</con:name><con:value>code</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>redirect_uri</con:name><con:value>${#Project#redirect_uri}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>scope</con:name><con:value>${#TestSuite#scope}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>state</con:name><con:value>133021</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>prompt</con:name><con:value>login</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>id_token_hint</con:name><con:value>old-id-token</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="transfer" name="AuthorizationResponseDetails" id="97813b82-9051-46f1-92a6-dadb085355ab"><con:description>Extract details that we need for the next request</con:description><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>sessionID</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>AuthorizationRequest - code</con:sourceStep><con:sourcePath>//input[@name='sessionID']/@value</con:sourcePath><con:targetType>sessionID</con:targetType><con:targetStep>Authentication</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>sessionData</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>AuthorizationRequest - code</con:sourceStep><con:sourcePath>//input[@name='sessionData']/@value</con:sourcePath><con:targetType>sessionData</con:targetType><con:targetStep>Authentication</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>location</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>AuthorizationRequest - code</con:sourceStep><con:sourcePath>//form/@action</con:sourcePath><con:targetType>Endpoint</con:targetType><con:targetStep>Authentication</con:targetStep><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="httprequest" name="Authentication" id="a6c3f9e3-d441-46a1-be68-6d03787ed103"><con:settings/><con:config method="POST" xsi:type="con:HttpRequest" id="2d4a94f2-41bf-49f3-85ea-b088fd75dcfa" name="Authentication" postQueryString="true" mediaType="application/x-www-form-urlencoded" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:description>Auhenticating the user. The request includes details of the previous response</con:description><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://your-gateway:8443/auth/oauth/v2/authorize/login</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>username</con:name><con:value>${#Project#resource_owner}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>password</con:name><con:value>${#Project#resource_owner_password}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>sessionID</con:name><con:value>a3f259a7-3046-4114-a07b-2502db4cca94</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>sessionData</con:name><con:value>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.ew0KICAgICJzZXNzaW9uIjogew0KICAgICAgICAic2Vzc2lvbklEIjoiYTNmMjU5YTctMzA0Ni00MTE0LWEwN2ItMjUwMmRiNGNjYTk0IiwNCiAgICAgICAgImV4cCI6MTUxMTM4NjUyMSwNCiAgICAgICAgImN1cnJlbnRfdXNlcm5hbWUiOiIiLA0KICAgICAgICAiY3VycmVudF91c2VyX2NvbnNlbnQiOiJub25lIiwNCiAgICAgICAgImN1cnJlbnRfdXNlcl9yb2xlIjoiIiwNCiAgICAgICAgImN1cnJlbnRfdXNlcl9hY3IiOiIwIiwNCiAgICAgICAgImN1cnJlbnRfdXNlcl9hdXRoVGltZSI6IjAiLA0KICAgICAgICAic2FsdCI6IiIsDQogICAgICAgICJ0aGlyZF9wYXJ0eV9zc29fdG9rZW4iOiIiLA0KICAgICAgICAidGhpcmRfcGFydHlfc3NvX3Rva2VuX3R5cGUiOiIiDQogICAgfSwNCiAgICAicmVxdWVzdF9jb25zZW50Ijogew0KICAgICAgICAiY2xpZW50X25hbWUiOiJDQStXb3JsZCsyMDE3K0RlbW8rQXBwLTEzMzAyMSIsDQogICAgICAgICJzY29wZV92ZXJpZmllZCI6Im9wZW5pZCtlbWFpbCtwcm9maWxlK29wZW5pZF9jbGllbnRfcmVnaXN0cmF0aW9uIg0KICAgIH0sDQogICAgInJlcXVlc3RfcGFyYW1ldGVycyI6IHsNCiAgICAgICAgImRpc3BsYXkiOiJwYWdlIiwNCiAgICAgICAgInByb21wdCI6ImxvZ2luIiwNCiAgICAgICAgImlkX3Rva2VuX2hpbnQiOiJvbGQtaWQtdG9rZW4iLA0KICAgICAgICAibG9naW5faGludCI6IiIsDQogICAgICAgICJhY3JfdmFsdWVzIjoiIiwNCiAgICAgICAgImNsaWVudF9pZCI6ImY4MTkwNjY1LTEyNWItNDllMi1hNWZlLWMxNmJhOGM4MWQ2NCIsDQogICAgICAgICJub25jZSI6IiIsDQogICAgICAgICJzY29wZSI6Im9wZW5pZCtlbWFpbCtwcm9maWxlK29wZW5pZF9jbGllbnRfcmVnaXN0cmF0aW9uIiwNCiAgICAgICAgIm1heF9hZ2UiOiAiIg0KICAgIH0NCn0.XErssedRhCgkAemOoSFeZq2ja3Rloxb2kgXI1-YHKT8</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>action</con:name><con:value>login</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="transfer" name="AuthenticationResponseDetails" id="bfb190a0-f647-4094-991c-c629eaf0086a"><con:description>Extract details for the next request</con:description><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>sessionID</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Authentication</con:sourceStep><con:sourcePath>//input[@name='sessionID']/@value</con:sourcePath><con:targetType>sessionID</con:targetType><con:targetStep>ConsentRequest</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>sessionData</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Authentication</con:sourceStep><con:sourcePath>//input[@name='sessionData']/@value</con:sourcePath><con:targetType>sessionData</con:targetType><con:targetStep>ConsentRequest</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>action</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Authentication</con:sourceStep><con:sourcePath>//input[@name='action']/@value</con:sourcePath><con:targetType>action</con:targetType><con:targetStep>ConsentRequest</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>location</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Authentication</con:sourceStep><con:sourcePath>//form/@action</con:sourcePath><con:targetType>Endpoint</con:targetType><con:targetStep>ConsentRequest</con:targetStep><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="httprequest" name="ConsentRequest" id="14d1cbb9-ec19-4ccf-a10d-ec2fe674b363"><con:settings/><con:config method="POST" xsi:type="con:HttpRequest" id="63624d4d-e15c-4f2b-8278-55b57e17fae5" name="ConsentRequest" postQueryString="true" mediaType="application/x-www-form-urlencoded" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:description>Request the 'Consent' page</con:description><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://your-gateway:8443/auth/oauth/v2/authorize/consent</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>sessionID</con:name><con:value>a3f259a7-3046-4114-a07b-2502db4cca94</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>sessionData</con:name><con:value>eyJ0eXAiOiJKV1QiLCJjdHkiOiJKV1QiLCJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0..OPPYxzLkYAVX-765fP46Lw.3oaBwTeflFTYTrrCaYEQtWtvl8T1Huy0YglDIt_nLO3KbVwMIdTgpDu1VZxV89GeNIfhi8k6hshthWG49BvukV9H8EiUmH3wc9JJde8cYtGT5BHB82P7tiEXdDxAKicqLfjZRjbI3_fvTZ8NG7PLjeu4JRqcrwdmrvurnVMZJVUxT8WRoGoWZpy-Pfs2VjKKWPx_kA_46BuILHGfr70fHpYgtswiXpN9MtqgQViCU82zY1soin2YiT5SKMOIIfx-2HohjeLebOhbejn65OcVyb-seXWUlUM8NKAurkgRJmupIqx4LfkjJN6iBUrmUIDAct6LVe77u6i5lgKKN7EUo7jsQWYX_LIiqh5TzxmfTtF2Ar2D-y2Nym7Q5GbTJACrNrZHwPsGuQpRm3OERZRVKnJ55BrcZkPdnVLRlb1T1du5l4BhSocioxxwqF6NDtPAL7584aBIwwiDlfGeGNnagdvwl6IC7Rre62tJdv7IMJ6PL75YqILTOmrb_-Jy3vRG6EkuyOkxykefs1eSXv_94iVSYZH8k1MX_scH571i5qjDFxjV_f_qS_AVP1Rck5zi2QNfEUbr1tM4mFlmm_NHCDoryt8quB6D1kTe4izH-3qFK6dIfrhi14iulmd22hSm5uEpW8HCYYHksIvc8MgAg_FXngIXdzK_W1m0PTGGI5Uf366gFc6r7-m2YlkmpCsn_kRqJfy6r70XX_D2zBH_Txx6xqFg5kdj5Wi5XlhgeOnEx32VQ7PdQbvWKAEnCuyXuPf84cNa8vnPDqZ_5H2kmMkGQKf5RWDKumH-KIPJTG5Ur9lzK_RZtsnVx4jE7MRp_Qy3xXUUhPeuDLr1AfHu7XlfKM-BFplfNOdub-bkLlWRrwue4od2tRbS2u0cdu56SOGQmZXelZiPGTyFWyPgX3RQ8hl6pSgXN4EtMsbuQDB2HB-QRYtSr07bjgEBKDjTM-ki-lhejHI0zHy7doU7AUcAD_EZ3CfdGVEA66AtFFujJrIbEuJKz4abLhq4yJcsg9Uf1VkxYIpTviDhdwfM1dBWlAFEsBeAUUaH-l5WXk-gNMgrAl3s8cKHysKseh9bNbXNr1DLE7TmmOQ_ag0ISKD4-gpo4a3rbs0AA5o84-ERE1wJNE01_QJzJW7nFovBAU-P_f6nGuLgV1D1lRU3t4CaSXiE_D0aBossBOOpvux9IxlxQWl-AAjA6wGdAo0Cvw5qsoQBti9KhP-nOuVxXwjagWd2F_Cwj6IKzi8X71NQ_LKcWIYcB31YGELXEtPXxPFoieYIPc_VN7ujLpFb3lYnqL6h-tYpZoHdxyUbqwhsGQI8HUrtKMtp7MwsIi_THg8elic6k-BUzZWg_vOzbuB3KouZhmS2tLnNIEN5d1Mt2xc1_s5Yw5Mli0mK7TLN3tJmWC3hxOMOgBCZXRSkeIYBc_n_6e_YBplQ9lGYsxyusaGlahFiAkybkXAkP80ODhR1ecdQ3F_OeJ2k83prT9hBj5jvKHjvJRnKJkggKktmqO3ZjgLbnzhiigPlJA48uNcK_w3DxLK4LcdPkcQTq-e6mrMkkkHjkGOepKcx5S-tM3wjxu2ovgHWh4-FXY4ADDxjzHf4YEaqn9hMYO0L-C0Mgzfbs_OXSc6pAN29KuhPFQS8jP7yC2dYHKf6b_yiZZOUOPHrWtDn5h2AklfIdV7nYKbtBXNdsg7VVPEMvC3VLIDeIG_VycI7lCGeB4ukOUWHeXe0rdNU16rDXtPOsZ3Hudid2_HdbhiB30rO0v2-d3hIULZTJa6KoLIhiY47pVuQo1VFYuEabxSEVjdchRaOsg9qeQ3ZdCZo3RPh_Fo.Jyanj1Foy3KY3Xe9_--zTA</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>action</con:name><con:value>consent</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="transfer" name="ConsentRequestDetails" id="d216157b-3378-40d0-8472-581ade5ca36c"><con:description>Extract details for the next request</con:description><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>sessionID</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>ConsentRequest</con:sourceStep><con:sourcePath>//input[@name='sessionID']/@value</con:sourcePath><con:targetType>sessionID</con:targetType><con:targetStep>Consent</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>sessionData</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>ConsentRequest</con:sourceStep><con:sourcePath>//input[@name='sessionData']/@value</con:sourcePath><con:targetType>sessionData</con:targetType><con:targetStep>Consent</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>location</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>ConsentRequest</con:sourceStep><con:sourcePath>//form/@action</con:sourcePath><con:targetType>Endpoint</con:targetType><con:targetStep>Consent</con:targetStep><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="httprequest" name="Consent" id="c4813f0b-090b-4c61-a949-add3909f227c"><con:settings/><con:config method="POST" xsi:type="con:HttpRequest" id="2fe0bc4d-61a9-4514-b6d5-a00d0e7357ea" name="Consent" postQueryString="true" mediaType="application/x-www-form-urlencoded" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:description>Grant (consent) access to my resources. Important with SOAPUI is to not follow the redirect in the response. That location does not exist!</con:description><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">false</con:setting></con:settings><con:endpoint>https://your-gateway:8443/auth/oauth/v2/authorize/consent</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>sessionID</con:name><con:value>a3f259a7-3046-4114-a07b-2502db4cca94</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>sessionData</con:name><con:value>eyJ0eXAiOiJKV1QiLCJjdHkiOiJKV1QiLCJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0..faRHs9avqmJZ-tL2AzmqAA._r5TkRJZ74KJlxob8hzSwEKEA3fMHJ0fFuq60CnaxUDFZfvLBqkzg9fxPhFPvSqQRKSvLYCJBHUJwhNJODQ-rPpH3eaMCQGfRELG-MJGjGXEYP1qHk6PjHjQJO6mRVADLXbfFKyS7PqmbAS7hb1P8EdTfBGp3oPmTUchIdDA70KYCGeIFcB4bpr57uqRripL_EU0kpv4QEBljyPbFSJo_2WwOE7co_g45E6uvUhUy4ZCDVL6WC_ovHJItHx2j1my3cV7VsykyEw8M10VXR-6nljZUprfoyHj0JseoTCgk8LUCXLmb90r5sWP8CRcF_FkpNCqpvKQGDxcI-MJ2UZPrka51uLR1pbUG3iPglUUsSbEyuFxu532huHINKV7LZJXje1r-K963QAy7xOYFZlYrsPRdtuf1nX9Mnm8gk4ZroSlLMQHWKAooND7Etijlr28D_W5Qr470pyr2mGzfMummUBc0XWVRW3OwxC4mfhNAL5WA9eTfI1mu-zS2zIRFQNug9iN6O1QvCO_sB_uE8Sn0i6xJG7NqX0evJIb0XcNSF5idm6MVZCeS-Z6Yr3cFFdbMlvHACXhnjnPYkwvqkn2d5GqBPOcr-OjjRd3cunX3OFXDoEfEhKcxsyuWmvfjx10DETpcBVbDGIJz87tb8VIjognAfWIcnP9IwPyc2h-6r8HbrblSVF0cqGgCF04U9uppOThKi0ux1GTAfMI-B7TIVfFJhq0UZaeE8-3Ritbo8MZuqlXUqDHZ363OvwxCMknfHKjNT4y9SExWHQTxbg8tIcg_DPvSIN96u2jB_wZi37MdET0CDtWkwFsdDjvnX4ZRU4ZKvWkWufq0Qvs_LSSdUeAvMxGfMg-Er4bSmBRRTAXbkamHVCgW7z6K1Nd3Y09dYd1csIdLAFwTT1hiwASNg4KoFpKdaURGPTqjlvbDAHhybCIo0mfScGCCWODYQ0WH914bAvPQVH9qYCZnZyrFD5wnuusATWxxCLbjsZc4y_a3HE5IyHQSGmk7qIdmwoVD27OGu11H3EImQ8E77iVwN_J_YXcVIHiDeSBhyyOsTab7HSFLDNlBlzQJTdqxPg_sX9ypT7bnvz8SOsHp2rlyJ_OLZqpUE4Qyf2WuUeJN8q3Hd25PIPiqznBMf3USP9ght0TRktDp0RLi9l1ty2sC1c0GdT6VcxWnx5iZ-Zd9-uI6IwMB7Hpb7OS5ohXex2HGgtOx7LZSZ52KJN7yFbQR5Ez7L_BuXBJzrVB5M3KPvlOKH3DLEt6RYZxxzI85Hw6LmWnH2CHBED7P0Q4Y0NTthZ31B6O1GMPjZL0O18Bx-U8uvEv3MZQEX32BajjA6rNwNmPMN5SwBsvC-AReZLLRwjuOyovsp6bBK1KL_1qANgk3fUW0Hqw3Gkp-l4VZZvK7MXDwEJUHHPWN0K0TDvHBdZ2ex4Od7arf7jxZWLtZRm23qoIV5kTax4mMW7ztnu9ryk6ryfGsPnyf-9CB0faU4__xvxoUnu4YMOQR77GhWC6_ZqyAsSzU0rzfdUyinbiSiU7gAbfaGdF5wWH9P8AcZaAzGULfY4JfCpqY2Qx43tFEop_-80B8iEpoi301aLbGd5ONPp0tZ3bkaT-Yo6h8YlKro2dph0bHIWnyaWvIuDislOGsLKWZs9xeSyBIMskBmvO6JZVgGPWhJqen72S4H-C-XgVyPNh4ThR6e8HcDDmrKQQsoh1Qlo5G5ukUUjfleoaiki4w8ULXaRoJkZb7n9xbX34PibaF3LD5SpFGd4xyQqdTHjEJq2Tq1hD2bb2_ASauiKT34A7o0YL9l543dwCbnwtrbVVWA-zrWp55kM.uyBudCWqb2DKVPhsLtZabQ</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>action</con:name><con:value>Grant</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="groovy" name="ExtractCode" id="cd21e13d-ca4b-490f-ac35-90ecbad31c11"><con:description>The 'code' was retured in the Location header. We now etract it from there</con:description><con:settings/><con:config><script>def location = testRunner.testCase.getTestStepByName("Consent").httpRequest.response.responseHeaders["Location"][0]
def m = location =~ /code=([^&amp;]+)/;
if (!m) {
throw new RuntimeException("No code returned!");
}
m.group(1);</script></con:config></con:testStep><con:testStep type="transfer" name="TransferCode" id="f0a6ff0c-4882-40e9-b8c2-3654f5584eca"><con:description>After extracting the 'code' we are using it in our 'TokenRequest'</con:description><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>code</con:name><con:sourceType>result</con:sourceType><con:sourceStep>ExtractCode</con:sourceStep><con:targetType>code</con:targetType><con:targetStep>TokenRequest</con:targetStep><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="httprequest" name="TokenRequest" id="fb3a3a0d-a80e-4eb7-bdb3-abed52bf6739"><con:settings/><con:config method="POST" xsi:type="con:HttpRequest" id="40f12287-ec84-4e44-a5c9-f1f9fa6a152b" name="TokenRequest" postQueryString="true" mediaType="application/x-www-form-urlencoded" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:description>Use the received 'code' to exchange it for an access_token</con:description><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#path_token}</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="50d93b89-fb3b-4b09-ad1c-46773a0418f4" name="status=200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>client_id</con:name><con:value>${#TestSuite#client_id}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>client_secret</con:name><con:value>${#TestSuite#client_secret}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>code</con:name><con:value>341d1687-e324-4688-abad-3ef5b5432951</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>grant_type</con:name><con:value>authorization_code</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>redirect_uri</con:name><con:value>${#Project#redirect_uri}</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="transfer" name="TransferToken" id="63b09ad1-3cdd-41fa-9d66-246f4980db4a"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>access_token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>TokenRequest</con:sourceStep><con:sourcePath>access_token</con:sourcePath><con:targetType>access_token</con:targetType><con:targetStep>Userinfo</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="httprequest" name="Userinfo" id="833fdb07-12ca-4780-9c9e-9e26fa11cc20"><con:settings/><con:config method="POST" xsi:type="con:HttpRequest" id="faee9095-b5f7-4060-989c-0def31a1dcdc" name="Userinfo" postQueryString="true" mediaType="application/x-www-form-urlencoded" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:description>Now we will use the received access_token to call the userinfo endpoint</con:description><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#path_userinfo}</con:endpoint><con:request/><con:assertion type="JsonPath Match" id="a533a2dc-0fd7-4c4e-ad08-ca0a191d7bde" name="preferred_username=resource_owner"><con:configuration><path>preferred_username</path><content>${#Project#resource_owner}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>access_token</con:name><con:value/><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:properties/></con:testCase><con:properties><con:property><con:name>path_token</con:name><con:value/></con:property><con:property><con:name>path_authorize</con:name><con:value/></con:property><con:property><con:name>path_userinfo</con:name><con:value/></con:property><con:property><con:name>path_jwks</con:name><con:value/></con:property><con:property><con:name>client_id</con:name><con:value/></con:property><con:property><con:name>client_secret</con:name><con:value/></con:property><con:property><con:name>scope</con:name><con:value/></con:property></con:properties></con:testSuite><con:properties><con:property><con:name>host_iss</con:name><con:value>https://your-domain:8443</con:value></con:property><con:property><con:name>resource_owner</con:name><con:value>your-username</con:value></con:property><con:property><con:name>resource_owner_password</con:name><con:value>your-password</con:value></con:property><con:property><con:name>path_configuration</con:name><con:value>/.well-known/openid-configuration</con:value></con:property><con:property><con:name>contact_alias</con:name><con:value>myalias</con:value></con:property><con:property><con:name>contact_email</con:name><con:value>my.name@domain.com</con:value></con:property><con:property><con:name>client_name</con:name><con:value>CA World 2017 Demo App</con:value></con:property><con:property><con:name>application_type</con:name><con:value>web</con:value></con:property><con:property><con:name>redirect_uri</con:name><con:value>https://soapui.ca.com/caworld2017/client</con:value></con:property></con:properties><con:wssContainer/><con:oAuth2ProfileContainer/><con:oAuth1ProfileContainer/><con:sensitiveInformation/></con:soapui-project>